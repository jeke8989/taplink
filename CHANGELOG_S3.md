# üìã –ß–µ–∫-–ª–∏—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

---

## üéØ –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. Backend (Nest.js)

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `backend/src/upload/upload.service.ts` - —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å S3
- ‚úÖ `backend/src/upload/upload.controller.ts` - API endpoints
- ‚úÖ `backend/src/upload/upload.module.ts` - –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∑–∫–∏

#### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `backend/src/app.module.ts` - –¥–æ–±–∞–≤–ª–µ–Ω UploadModule
- ‚úÖ `backend/.env` - –¥–æ–±–∞–≤–ª–µ–Ω—ã S3 credentials

#### –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
- ‚úÖ `@aws-sdk/client-s3` - AWS SDK –¥–ª—è S3
- ‚úÖ `multer` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ `@types/multer` - —Ç–∏–ø—ã –¥–ª—è multer
- ‚úÖ `uuid` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID
- ‚úÖ `@nestjs/platform-express` - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è multer

### 2. Frontend (React)

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `frontend/src/api/upload.ts` - API –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ `frontend/src/components/ImageUploader.tsx` - –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- ‚úÖ `frontend/src/components/ImageUploadButton.tsx` - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- ‚úÖ `frontend/src/hooks/useImageUpload.ts` - —Ö—É–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ `frontend/.env` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API –∏ S3

#### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏:
- ‚úÖ `frontend/src/components/BlockEditor/blocks/AvatarBlock.tsx`
- ‚úÖ `frontend/src/components/BlockEditor/blocks/EventGalleryBlock.tsx`
- ‚úÖ `frontend/src/components/BlockEditor/blocks/EventSpeakersBlock.tsx`

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `frontend/src/components/IMAGE_UPLOAD_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- ‚úÖ `S3_INTEGRATION.md` - –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `CHANGELOG_S3.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### 3. API Endpoints

–°–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ endpoints (—Ç—Ä–µ–±—É—é—Ç JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|----------|-------|----------|-----------|
| `/upload/image` | POST | –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ | `file` (multipart/form-data) |
| `/upload/images` | POST | –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | `files` (multipart/form-data) |
| `/upload/avatar` | POST | –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä | `file` (multipart/form-data) |

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### S3 Credentials (–¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ .env):
```
S3_ENDPOINT=https://s3.twcstorage.ru
S3_BUCKET=50c4aa15-b1cfc493-c256-4b3e-8b12-f6a10518200e
S3_REGION=ru-1
S3_ACCESS_KEY_ID=YNRUA3Q8FL3DCDJL0OGP
S3_SECRET_ACCESS_KEY=ykrAm82mZA2vQKy7fxOry3hXCDHU7e9JAkWwIZHZ
```

---

## üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (JPEG, PNG, GIF, WEBP)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å–∏–º—É–º 10MB –Ω–∞ —Ñ–∞–π–ª)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å–∏–º—É–º 10 –∑–∞ —Ä–∞–∑)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö endpoints
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ backend –∏ frontend
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ (UUID)

### UX
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ (spinner)
- ‚úÖ Preview –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –≤—Å—Ç–∞–≤–∫—É URL

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º Nest.js (Module/Controller/Service)
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã React —Å —Ö—É–∫–∞–º–∏
- ‚úÖ TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

## üì¶ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 9
- **–û–±–Ω–æ–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 5
- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–∞–∫–µ—Ç–æ–≤:** 5
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~700+
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 3 —Ñ–∞–π–ª–∞

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### Backend
```bash
cd backend
npm run start:dev
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoints –≤ Postman/Insomnia:
- POST http://localhost:3000/upload/image (—Å —Ñ–∞–π–ª–æ–º –∏ JWT —Ç–æ–∫–µ–Ω–æ–º)

### Frontend
```bash
cd frontend
npm run dev
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –±–ª–æ–∫–æ–≤
2. –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ "–ê–≤–∞—Ç–∞—Ä" –∏–ª–∏ "–ì–∞–ª–µ—Ä–µ—è"
3. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
4. –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–ª–æ–∫–∞—Ö
–ó–∞–≥—Ä—É–∑—á–∏–∫ —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤:
- `AvatarBlock` - –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞
- `EventGalleryBlock` - –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏
- `EventSpeakersBlock` - –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Å–ø–∏–∫–µ—Ä–æ–≤

### –í –Ω–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö
–ü—Ä–æ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
```tsx
import ImageUploadButton from '../../ImageUploadButton';

<ImageUploadButton
  onUploadComplete={(url) => setImageUrl(url)}
  currentImage={imageUrl}
/>
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ S3
- [ ] –û–±—Ä–µ–∑–∫–∞ –∏ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] Drag & drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ (–∫—Ä—É–≥–ª–∞—è –æ–±—Ä–µ–∑–∫–∞)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `.env` —Ñ–∞–π–ª–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore`
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization
3. **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø:** –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø—É–±–ª–∏—á–Ω–æ (ACL: public-read)
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è .env —Ñ–∞–π–ª–æ–≤ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–π UI
- ‚úÖ –í–∏–¥–µ—Ç—å preview –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –ü–æ–ª—É—á–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –¥–æ 10MB
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∑–∞–≥—Ä—É–∑—á–∏–∫, —Ç–∞–∫ –∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ URL

–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–∞–¥—ë–∂–Ω–æ–º S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ CDN.

---

**–°–æ–∑–¥–∞–Ω–æ AI Assistant**  
**–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** ‚ú®

